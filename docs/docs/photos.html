<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<title data-react-helmet="true">Photos | Doodle Tutorials</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-react-helmet="true" property="og:url" content="https://nacular.github.io/doodle-tutorials/docs/photos"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="og:image:width" content="380"><meta data-react-helmet="true" name="og:image:height" content="78"><meta data-react-helmet="true" property="og:title" content="Photos | Doodle Tutorials"><meta data-react-helmet="true" name="description" content="We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop."><meta data-react-helmet="true" property="og:description" content="We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop."><link data-react-helmet="true" rel="icon" href="/doodle-tutorials/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://nacular.github.io/doodle-tutorials/docs/photos"><link data-react-helmet="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/photos" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/photos" hreflang="x-default"><link rel="stylesheet" href="/doodle-tutorials/assets/css/styles.c4e9ac92.css">
<link rel="preload" href="/doodle-tutorials/assets/js/runtime~main.bc7b23e1.js" as="script">
<link rel="preload" href="/doodle-tutorials/assets/js/main.8507df74.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doodle-tutorials/"><div class="navbar__logo"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/doodle-tutorials/docs/introduction">Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nacular/doodle-tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kotlinlang.slack.com/messages/doodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Slack channel"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/doodle-tutorials/"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--dark_uzRr"></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/calculator">Calculator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/todo">Todo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doodle-tutorials/docs/photos">Photos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photostream">Photo Stream</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1><a href="https://github.com/nacular/doodle-tutorials/tree/master/Photos" target="_blank" rel="noopener noreferrer">Photos</a> Tutorial</h1></header><p>We will build a simple photo app that lets you view and manipulate images using a pointer or multi-touch. Images will be added to the app via drag-drop.
You can then move, size, and rotate them with a mouse, pointer, touch, or via an info overlay.</p><p>Here is the end result.</p><div class="doodle_-SGP"><div style="position:relative;height:700px"></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>You can also see the full-screen app <a href="https://nacular.github.io/doodle-tutorials/photos" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="project-setup">Project Setup<a aria-hidden="true" class="hash-link" href="#project-setup" title="Direct link to heading">â€‹</a></h2><p>We will use a JS only-setup for this app.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugins {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    kotlin(&quot;js&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kotlin {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    jsTargets()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Defined in gradle.properties</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val doodleVersion    : String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val coroutinesVersion: String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sourceSets {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val commonMain by getting {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            dependencies {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib-js&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core-js:$coroutinesVersion&quot;) // async image loading</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;io.nacular.doodle:core:$doodleVersion&quot;     ) // required for Doodle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;io.nacular.doodle:browser:$doodleVersion&quot;  ) // required for Doodle in the browser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;io.nacular.doodle:controls:$doodleVersion&quot; ) // provides things like buttons and panels</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;io.nacular.doodle:animation:$doodleVersion&quot;) // animations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;io.nacular.doodle:themes:$doodleVersion&quot;   ) // for Basic theme</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="the-application">The Application<a aria-hidden="true" class="hash-link" href="#the-application" title="Direct link to heading">â€‹</a></h2><p>All Doodle apps must implement the <a href="https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/application/Application.kt#L4" target="_blank" rel="noopener noreferrer"><code>Application</code></a>
interface. The framework will then initialize our app via the constructor.</p><p>The app&#x27;s structure is fairly simple. It has a main Container that holds the images and supports drag-drop, and a panel with controls for manipulating
a selected image.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/src/commonMain/kotlin/io/nacular/doodle/examples/PhotosApp.kt#L11" target="_blank" rel="noopener noreferrer"><strong>PhotosApp.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class PhotosApp(/*...*/): Application {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    init {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val panelToggle                 // Button used to show/hide the panel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val panel                       // Has controls for manipulating images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val mainContainer = container { // container that holds images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            dropReceiver = object: DropReceiver {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // support drag-drop importing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            GlobalScope.launch {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                listOf(&quot;tetons.jpg&quot;, &quot;earth.jpg&quot;).forEachIndexed { index, file -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    // load default images</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        display += listOf(mainContainer, panel, panelToggle)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun shutdown() {}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Notice that <code>shutdown</code> is a no-op, since we don&#x27;t have any cleanup to do when the app closes.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="creating-a-full-screen-app">Creating A Full Screen App<a aria-hidden="true" class="hash-link" href="#creating-a-full-screen-app" title="Direct link to heading">â€‹</a></h2><p>Doodle apps can be <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer">launched</a> in a few different ways.
We create a helper to launch the app in <a href="https://nacular.github.io/doodle/docs/applications#top-level-apps" target="_blank" rel="noopener noreferrer">full screen</a>.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Photos/src/main/kotlin/io/nacular/doodle/examples/FullScreen.kt#L22" target="_blank" rel="noopener noreferrer"><strong>FullScreen.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package io.nacular.doodle.examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun fullscreen() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    application(modules = listOf(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        FocusModule,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        KeyboardModule,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        DragDropModule,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        basicLabelBehavior(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        nativeTextFieldBehavior(spellCheck = false),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        basicMutableSpinnerBehavior(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        basicCircularProgressIndicatorBehavior(thickness = 18.0),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Module(name = &quot;AppModule&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bindSingleton&lt;Animator&gt;    { AnimatorImpl   (instance(), instance()) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bindSingleton&lt;ImageLoader&gt; { ImageLoaderImpl(instance(), instance()) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // load app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PhotosApp(instance(), instance(), instance(), instance(), instance(), instance())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Normally this would just be your <code>main</code> function. But <code>main</code> would prevent the app from being used as a library. Which
is what happens to allow both an embedded (in the docs) and full-screen version.</p></div></div><p>The <code>application</code> function launches apps. It takes a list of modules, and a lambda that builds the
app. This lambda is within a Kodein injection context, which means we can inject dependencies into our app via
<code>instance</code>, <code>provider</code>, etc.</p><p>Notice that we have included several modules for our app. This includes one for focus, keyboard, drag-drop and several for various
View <a href="https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/core/Behavior.kt#L7" target="_blank" rel="noopener noreferrer"><code>Behaviors</code></a>
(i.e. <a href="https://github.com/nacular/doodle/blob/master/Browser/src/jsMain/kotlin/io/nacular/doodle/theme/native/NativeTheme.kt#L108" target="_blank" rel="noopener noreferrer"><code>nativeTextFieldBehavior()</code></a>)
which loads the native behavior for TextFields. We also define some bindings directly in a new module. These are items with no
built-in module, or items that only exist in our app code.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Check out Kodein to learn more about how it handles dependency injection.</p></div></div><p>The <code>application</code> function also takes an optional HTML element within which the app will be hosted. The app will be hosted in
<code>document.body</code> if you do not specify an element.</p><p>App launching is the only part of our code that is platform-specific; since it is the only time we might care
about an HTML element. It also helps support embedding apps into non-Doodle contexts.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="drag-drop-support">Drag-drop Support<a aria-hidden="true" class="hash-link" href="#drag-drop-support" title="Direct link to heading">â€‹</a></h2><p>Drag-drop support requires the <code>DragDropModule</code> (<a href="https://github.com/nacular/doodle/blob/master/Browser/src/jsMain/kotlin/io/nacular/doodle/application/Modules.kt#L94" target="_blank" rel="noopener noreferrer">Browser</a> or <a href="https://github.com/nacular/doodle/blob/master/Desktop/src/jvmMain/kotlin/io/nacular/doodle/application/Modules.kt#L81" target="_blank" rel="noopener noreferrer">Desktop</a> to work. It then requires setting up drag/drop recognizers on the source/target Views. We created
the <code>mainContainer</code> for this. You can see that the <code>dropReceiver</code> property is set to a <code>DropReceiver</code> that controls how the <code>mainContainer</code> handles
drop events.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class PhotosApp(/*...*/ private val images: ImageLoader /*...*/): Application {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    init {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val mainContainer = container {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            dropReceiver = object: DropReceiver {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                private  val allowedFileTypes                    = Files(ImageType(&quot;jpg&quot;), ImageType(&quot;jpeg&quot;), ImageType(&quot;png&quot;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override val active                              = true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                private  fun allowed          (event: DropEvent) = allowedFileTypes in event.bundle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override fun dropEnter        (event: DropEvent) = allowed(event)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override fun dropOver         (event: DropEvent) = allowed(event)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override fun dropActionChanged(event: DropEvent) = allowed(event)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override fun drop             (event: DropEvent) = event.bundle[allowedFileTypes]?.let { files -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    val photos = files.map { GlobalScope.async { images.load(it)?.let { FixedAspectPhoto(it) } } }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    GlobalScope.launch {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        photos.mapNotNull { it.await() }.forEach { photo -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            import(photo, event.location)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                } ?: false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Our <code>DropReceiver</code> specifies the supported file-types (jpg, jpeg, and png). It then checks that any drop event contains valid files before accepting it. The
<code>drop(event: DropEvent)</code> method is called when the user attempts the final drop. Here, the receiver fetches all the allowed files in the bundle,
and tries to load and import each one. Notice that the receiver converts raw Image returned by <code>ImageLoader</code> into a <code>FixedAspectPhoto</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="importing-an-image">Importing An Image<a aria-hidden="true" class="hash-link" href="#importing-an-image" title="Direct link to heading">â€‹</a></h2><p>We import images using a local <code>import</code> function inside the <code>mainContainer</code> creation block. This simplifies access to local state. The <code>import</code>
function takes a photo, which is a <code>View</code>, and a location to place it.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">val import = { photo: View, location: Point -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Import resizes and centers the photo at the given point. It is center-rotates it between -15Â° and 15Â°. Finally, a listener is added to the <code>pressed</code>
pointer event. This moves the photo to the foreground and updates the panel.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">photo.width           = 400.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">photo.position        = location - Point(photo.width / 2, photo.height / 2)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">photo.transform       = Identity.rotate(location, (Random.nextFloat() * 30 - 15) * degrees)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">photo.pointerChanged += pressed {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    children.move(photo, to = children.size - 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    panel.setPhoto(photo)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="using-gestures">Using Gestures<a aria-hidden="true" class="hash-link" href="#using-gestures" title="Direct link to heading">â€‹</a></h2><p>Import also registers a custom gesture listener to support multi-touch scaling and rotations.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">GestureRecognizer(photo).changed += object: GestureListener&lt;GestureEvent&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun started(event: GestureEvent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // capture initial state</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        event.consume()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun changed(event: GestureEvent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // 1) calculate rotation angle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // 2) update photo transform to include rotation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // 3) update photo bounds based on scaling</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        event.consume()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun ended(event: GestureEvent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // simply consume event</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        event.consume()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>GestureRecognizer</code> takes a <code>View</code> and emits events whenever it detects motion from 2 or more pointers in that <code>View</code>. It also calculates
a scale value by comparing the distance between the selected pointers over time.</p><p>We register a listener that uses the events to update the photo&#x27;s <code>transform</code> and <code>bounds</code>. The listener also consumes events to avoid
them making it to subsequent pointer listeners (the <code>Resizer</code> used for single pointer manipulation in this case).</p><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="capturing-initial-gesture-state">Capturing Initial Gesture State<a aria-hidden="true" class="hash-link" href="#capturing-initial-gesture-state" title="Direct link to heading">â€‹</a></h3><p>We record the state of our photo, and the pointers provided by the <code>GestureRecognizer</code> on the <code>started</code> event. Notice that <code>GestureRecognizer</code>
provides locations in the photo&#x27;s local coordinate. This makes sense for a general-purpose utility and matches the way Doodle reports
pointer events. We use these values to modify the photo&#x27;s bounds though, which is defined in its parent&#x27;s coordinates. So we map the points
into the parent before our calculations.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">override fun started(event: GestureEvent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Capture initial state to apply deltas with in `changed`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    originalSize     = photo.size</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    originalCenter   = this@container.toLocal(event.center, photo)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    originalVector   = event.initial[1].inParent(photo) - event.initial[0].inParent(photo)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    originalPosition = photo.position</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    initialTransform = photo.transform</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event.consume() // ensure event is consumed from Resizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="handling-gesture-updates">Handling Gesture Updates<a aria-hidden="true" class="hash-link" href="#handling-gesture-updates" title="Direct link to heading">â€‹</a></h3><p>The values recorded in <code>started</code> are used--along with the new state--in the <code>changed</code> event to update the selected photo.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">override fun changed(event: GestureEvent) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val currentVector = event.current[1].inParent(photo) - event.current[0].inParent(photo)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Angle between initial set of points and their current locations</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val transformAngle = atan2(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        originalVector.x * currentVector.y - originalVector.y * currentVector.x,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        originalVector.x * currentVector.x + originalVector.y * currentVector.y</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Use transform for rotation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    photo.transform = initialTransform.rotate(around = originalCenter, by = transformAngle)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Update bounds instead of scale transformation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    photo.bounds = Rectangle(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            originalPosition - ((originalPosition - originalCenter) * (1 - event.scale)),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            originalSize * event.scale)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    event.consume() // ensure event is consumed from Resizer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/doodle-tutorials/docs/todo"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Todo</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/doodle-tutorials/docs/photostream"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Photo Stream<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-setup" class="table-of-contents__link toc-highlight">Project Setup</a></li><li><a href="#the-application" class="table-of-contents__link toc-highlight">The Application</a></li><li><a href="#creating-a-full-screen-app" class="table-of-contents__link toc-highlight">Creating A Full Screen App</a></li><li><a href="#drag-drop-support" class="table-of-contents__link toc-highlight">Drag-drop Support</a></li><li><a href="#importing-an-image" class="table-of-contents__link toc-highlight">Importing An Image</a></li><li><a href="#using-gestures" class="table-of-contents__link toc-highlight">Using Gestures</a><ul><li><a href="#capturing-initial-gesture-state" class="table-of-contents__link toc-highlight">Capturing Initial Gesture State</a></li><li><a href="#handling-gesture-updates" class="table-of-contents__link toc-highlight">Handling Gesture Updates</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/doodle-tutorials/assets/js/runtime~main.bc7b23e1.js"></script>
<script src="/doodle-tutorials/assets/js/main.8507df74.js"></script>
</body>
</html>