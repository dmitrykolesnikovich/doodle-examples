<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<title data-react-helmet="true">Calculator | Doodle Tutorials</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-react-helmet="true" name="twitter:image" content="https://nacular.github.io/doodle-tutorials/img/site_preview.png"><meta data-react-helmet="true" property="og:url" content="https://nacular.github.io/doodle-tutorials/docs/calculator"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="og:image:width" content="380"><meta data-react-helmet="true" name="og:image:height" content="78"><meta data-react-helmet="true" property="og:title" content="Calculator | Doodle Tutorials"><meta data-react-helmet="true" name="description" content="Our goal is to build the following calculator app using Doodle. This is a simple calculator that only"><meta data-react-helmet="true" property="og:description" content="Our goal is to build the following calculator app using Doodle. This is a simple calculator that only"><link data-react-helmet="true" rel="icon" href="/doodle-tutorials/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://nacular.github.io/doodle-tutorials/docs/calculator"><link data-react-helmet="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/calculator" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nacular.github.io/doodle-tutorials/docs/calculator" hreflang="x-default"><link rel="stylesheet" href="/doodle-tutorials/assets/css/styles.c4e9ac92.css">
<link rel="preload" href="/doodle-tutorials/assets/js/runtime~main.7ef2cd64.js" as="script">
<link rel="preload" href="/doodle-tutorials/assets/js/main.8507df74.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_RReh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doodle-tutorials/"><div class="navbar__logo"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/doodle-tutorials/docs/introduction">Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nacular/doodle-tutorials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kotlinlang.slack.com/messages/doodle" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Slack channel"></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0 sidebarWithHideableNavbar_VlPv"><a tabindex="-1" class="sidebarLogo_hmkv" href="/doodle-tutorials/"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/doodle-tutorials/img/doodle.svg" alt="Doodle Logo" class="themedImage_TMUO themedImage--dark_uzRr"></a><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/doodle-tutorials/docs/calculator">Calculator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/todo">Todo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photos">Photos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doodle-tutorials/docs/photostream">Photo Stream</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1><a href="https://github.com/nacular/doodle-tutorials/tree/master/Calculator" target="_blank" rel="noopener noreferrer">Calculator</a> Tutorial</h1></header><p>Our goal is to build the following calculator app using Doodle. This is a simple calculator that only
performs addition, subtraction, multiplication, and division. It also supports negative values, decimals,
and has a convenience function for converting to a percentage.</p><p>However, it does not have more advanced features, like parentheses, or other math operations. This means
the implementation is simpler, and we can focus on the way Doodle is used instead of the complexity of the
app itself.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Play around with the calculator to get a feel for it.</p></div></div><div class="doodle_-SGP"><div style="position:relative;height:500px"></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>You can also see the full-screen app <a href="https://nacular.github.io/doodle-tutorials/calculator" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="project-setup">Project Setup<a aria-hidden="true" class="hash-link" href="#project-setup" title="Direct link to heading">â€‹</a></h2><p>We will use a multi-platform setup for this app. This is not necessary to use Doodle, but it lets us implement our code almost
entirely in commonMain and our tests in commonTest. We will then be able to run these tests on the JVM target, which will
make their execution really fast and completely decoupled from the JS environment.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/build.gradle.kts" target="_blank" rel="noopener noreferrer"><strong>build.gradle.kts</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">plugins {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    kotlin(&quot;multiplatform&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kotlin {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Defined in buildSrc/src/main/kotlin/Common.kt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    jsTargets ()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    jvmTargets()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Defined in gradle.properties</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val mockkVersion     : String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val mockkJsVersion   : String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val doodleVersion    : String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    val coroutinesVersion: String by project</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sourceSets {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val commonMain by getting {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            dependencies {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(kotlin(&quot;stdlib-common&quot;))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // needed for async font discovery</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core-common:$coroutinesVersion&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                api (&quot;io.nacular.doodle:core:$doodleVersion&quot;    ) // required for Doodle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                api (&quot;io.nacular.doodle:browser:$doodleVersion&quot; ) // required for Doodle in the browser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                api (&quot;io.nacular.doodle:controls:$doodleVersion&quot;) // provides things like buttons and panels</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       // ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="defining-our-application">Defining Our Application<a aria-hidden="true" class="hash-link" href="#defining-our-application" title="Direct link to heading">â€‹</a></h2><p>All Doodle apps must implement the <a href="https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/application/Application.kt#L4" target="_blank" rel="noopener noreferrer"><code>Application</code></a>
interface. The framework will then initialize our app via the constructor. Our app will be fairly simple: just create
an instance of our calculator and add it to the display.</p><p>Doodle apps can be defined in <code>commonMain</code>, since they do not require any platform-specific dependencies. Therefore, we will do
the same and place ours in <code>commonMain/kotlin/io/nacular/doodle/examples</code>.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/CalculatorApp.kt#L11" target="_blank" rel="noopener noreferrer"><strong>CalculatorApp.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package io.nacular.doodle.examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CalculatorApp(display: Display): Application {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    init {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // creat and display a single Calculator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        display += Calculator()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun shutdown() { /* no-op */ }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Notice that <code>shutdown</code> is a no-op, since we don&#x27;t have any cleanup to do when the app closes.</p></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="launching-on-web-and-desktop">Launching on Web and Desktop<a aria-hidden="true" class="hash-link" href="#launching-on-web-and-desktop" title="Direct link to heading">â€‹</a></h2><p>Doodle apps can be <a href="https://nacular.github.io/doodle/docs/applications" target="_blank" rel="noopener noreferrer">launched</a> in a few different ways on Web and Desktop. We defined our app logic
in a multi-platform <code>Calculator</code> library (no <code>main</code> functions), so it can be used on both platforms. Notice that we are only using a library here because we also want
to run the Calculator in our documentation app. That app will run it as an embedded Web app, which becomes easier if it is a library. Otherwise,
we could have defined our platform <code>main</code> functions directly in the <code>Calculator</code> module. Instead, we created a separate <code>CalculatorRunner</code> module that contains our <code>main</code> functions.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="creating-a-fullscreen-web-app">Creating A Fullscreen Web App<a aria-hidden="true" class="hash-link" href="#creating-a-fullscreen-web-app" title="Direct link to heading">â€‹</a></h2><p>We create a helper to launch the app in <a href="https://nacular.github.io/doodle/docs/applications#top-level-apps" target="_blank" rel="noopener noreferrer">full screen</a>.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/jsMain/kotlin/io/nacular/doodle/examples/FullScreen.kt#L12" target="_blank" rel="noopener noreferrer"><strong>FullScreen.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package io.nacular.doodle.examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun fullScreen() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    application(modules = listOf(PointerModule)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // load app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CalculatorApp(instance()) // provide the Display</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Normally this would just be your <code>main</code> function, but this would prevent the app from being used as a library. Which
is what happens to allow both an embedded (in the docs) and full-screen version.</p></div></div><p>Use the <code>application</code> function to launch top-level apps. It takes a list of modules to and a lambda that builds the
app. This lambda is within a Kodein injection context, which means we can inject dependencies into our app via
<code>instance</code>, <code>provider</code>, etc.</p><p>Notice that we have included the <a href="https://github.com/nacular/doodle/blob/master/Browser/src/jsMain/kotlin/io/nacular/doodle/application/Modules.kt#L62" target="_blank" rel="noopener noreferrer"><code>PointerModule</code></a>.
This is needed to enable mouse or pointer interactions. Our app will not directly know we loaded this module, but pointer
related events will only work because we have.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Check out Kodein to learn more about how it handles dependency injection.</p></div></div><p>The <code>application</code> function also takes an optional HTML element within which the app will be hosted. The app will be hosted in
<code>document.body</code> if no element is specified.</p><p>App launching is the only part of our code that is platform-specific. This makes sense, since it is the only time we might need to know
about an HTML element; say when embedding our app in a non-Doodle context.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="the-calculator-view">The Calculator View<a aria-hidden="true" class="hash-link" href="#the-calculator-view" title="Direct link to heading">â€‹</a></h2><p>We will implement our calculator as a single <a href="https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/core/View.kt#L65" target="_blank" rel="noopener noreferrer"><code>View</code></a>
that manages its state directly. This makes sense for simple use-cases, but might not be the right choice for larger apps.</p><p>This View will be broken into a hierarchy of views, with two top-level items: a custom output and a <a href="https://github.com/nacular/doodle/blob/master/Controls/src/commonMain/kotlin/io/nacular/doodle/controls/panels/GridPanel.kt#L42" target="_blank" rel="noopener noreferrer"><code>GridPanel</code></a>.</p><br><img src="/doodle-tutorials/calc-top2.png" alt="doodle"><img src="/doodle-tutorials/calc-bottom2.png" alt="doodle" style="float:right"><h3 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="calculator-output">Calculator Output<a aria-hidden="true" class="hash-link" href="#calculator-output" title="Direct link to heading">â€‹</a></h3><p>The Output will be a really simple View that tracks a number and its text representation, which it will render to the screen.
It will also expose the number as the current &quot;answer&quot; on the calculator. Its most complex role is displaying the text with
proper alignment and scaling to avoid any clipping.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Notice how the output text starts off center aligned with the operator buttons; and how it shrinks as the number grows
beyond the screen size.</p></div></div><p>Take a look at the <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L48" target="_blank" rel="noopener noreferrer"><strong>Output</strong></a>
class, and you will see it has a <code>text</code> property that it tracks the width of. It also uses <code>textTransform</code> to perform the text scaling.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">private inner class Output: View() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Transform used to scale text down as it grows beyond window width</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private var textTransform = Identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    /** Text representation of number */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var text = &quot;0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        set(new) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            field = new</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val textWidth   = textMetrics.width(field, font)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val windowWidth = width - inset * 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // use transform when text grows beyond window width</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            textTransform = when {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                textWidth &gt; windowWidth -&gt; (windowWidth/textWidth).let { Identity.scale(x = it, y = it, around = Point(width / 2, height)) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                else                    -&gt; Identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rerender()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun render(canvas: Canvas) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val textPosition = textMetrics.size(text, font).let {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val x = when {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                textTransform.isIdentity -&gt; width - it.width - inset</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                else                     -&gt; (width - it.width) / 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Point(x, height - it.height)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // scaling, if present, is applied to the canvas before text rendered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        canvas.transform(textTransform) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            text(text, at = textPosition, font = font, color = foregroundColor ?: White)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="more-dependencies">More Dependencies<a aria-hidden="true" class="hash-link" href="#more-dependencies" title="Direct link to heading">â€‹</a></h2><p>The <code>Output</code> class, and others in <code>Calculator</code> need things like fonts, and the ability to measure text. Doodle provides
these capabilities via interfaces like <code>FontDetector</code> and <code>TextMetrics</code>. These can be provided to <code>Calculator</code> via
constructor injection.</p><p>That results in a constructor as follows:</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L35" target="_blank" rel="noopener noreferrer"><strong>Calculator.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Calculator(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        private val fonts          : FontDetector,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        private val textMetrics    : TextMetrics,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        private val numberFormatter: NumberFormatter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">): View() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This means <code>CalculatorApp</code> needs to be updated as well. We continue by injecting these dependencies there as well.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package io.nacular.doodle.examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CalculatorApp(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        display        : Display,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        textMetrics    : TextMetrics,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fontDetector   : FontDetector,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        numberFormatter: NumberFormatter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">): Application {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    init {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // creat and display a single Calculator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        display += Calculator(fontDetector, textMetrics, numberFormatter)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun shutdown() { /* no-op */ }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now <code>Main</code> needs to provide these, along with Display, when constructing the app.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">package io.nacular.doodle.examples</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fun main() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    application(modules = listOf(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PointerModule,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Module(name = &quot;AppModule&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Used to get fonts that should&#x27;ve been loaded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            bind&lt;FontDetector&gt;() with singleton { FontDetectorImpl(instance(), instance(), instance()) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // load app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CalculatorApp(instance(), instance(), instance(), NumberFormatterImpl())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Unlike <code>TextMetrics</code>, <code>FontDetector</code> is not included in Doodle&#x27;s default modules, so we have to wire it explicitly.
We define a new <code>Module</code> to do so because it has dependencies that can be injected as well.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="the-buttons">The Buttons<a aria-hidden="true" class="hash-link" href="#the-buttons" title="Direct link to heading">â€‹</a></h2><p>We can manage the set of buttons within the calculator with a <code>GridPanel</code>. This way we get the layout support it provides.
This results in the following initialization for <code>Calculator</code>.</p><p><a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/Calculator.kt#L35" target="_blank" rel="noopener noreferrer"><strong>Calculator.kt</strong></a></p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Calculator(/*...*/): View() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    init {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        GlobalScope.launch {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            loadFonts()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ButtonGroup(allowDeselectAll = true, buttons = *arrayOf(`Ã·`, `*`, `-`, `+`))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val outputHeight  = 100.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val buttonSpacing =  10.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val gridPanel = GridPanel().apply {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                add(clear, 0, 0); add(negate, 0, 1); add(`%`, 0, 2); add(`Ã·`, 0, 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                add(`7`,   1, 0); add(`8`,    1, 1); add(`9`, 1, 2); add(`*`, 1, 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                add(`4`,   2, 0); add(`5`,    2, 1); add(`6`, 2, 2); add(`-`, 2, 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                add(`1`,   3, 0); add(`2`,    3, 1); add(`3`, 3, 2); add(`+`, 3, 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                add(`0`,   4, 0,  columnSpan = 2  ); add(decimal, 4, 2); add(`=`,  4, 3)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                verticalSpacing   = buttonSpacing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                horizontalSpacing = buttonSpacing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            children += listOf(output, gridPanel)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Place output outside grid so the height can be more easily controlled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            val constraints = constrain(output, gridPanel) { output, grid -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                output.top    = parent.top</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                output.left   = parent.left</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                output.right  = parent.right</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                output.height = constant(outputHeight)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                grid.top      = output.bottom + buttonSpacing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                grid.left     = output.left</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                grid.right    = output.right</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                grid.bottom   = parent.bottom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            layout = object: Layout by constraints {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // Set total height to grid panel&#x27;s ideal width and height, plus output and spacing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                override fun idealSize(container: PositionableContainer, default: Size?) = gridPanel.idealSize?.let {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Size(it.width, it.height + outputHeight + buttonSpacing)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Force idealSize when gridPanel is laid out</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            gridPanel.sizePreferencesChanged += { _,_,new -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                idealSize = new.idealSize?.let { Size(it.width, it.height + outputHeight + buttonSpacing) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The initialization steps are: <strong>(1) load fonts</strong>, <strong>(2) setup buttons in GridPanel</strong>, <strong>(3) add Output and grid as children</strong>,
<strong>(4) configure the layout</strong>.</p><p>This example uses non-standard/recommended property names for buttons to improve readability slightly. This also makes tests a little
simpler to understand.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="button-styling">Button Styling<a aria-hidden="true" class="hash-link" href="#button-styling" title="Direct link to heading">â€‹</a></h2><p>The calculator buttons come in a few different color schemes. But they all share the same <a href="https://github.com/nacular/doodle/blob/master/Core/src/commonMain/kotlin/io/nacular/doodle/core/Behavior.kt#L7" target="_blank" rel="noopener noreferrer"><code>Behavior</code></a>,
defined by <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonMain/kotlin/io/nacular/doodle/examples/CalcButtonBehavior.kt#L16" target="_blank" rel="noopener noreferrer"><code>CalcButtonBehavior</code></a>.
Buttons--like many Views--let you define their look-and-feel using a <code>Behavior</code>. Ours is fairly simple; it draws the rounded rectangle
for the button background and centers the text above it. These are both managed with the right color based on the button&#x27;s state.
It gets state tracking and text positiong for free via its base class: <code>CommonTextButtonBehavior</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="custom-hit-detection">Custom Hit Detection<a aria-hidden="true" class="hash-link" href="#custom-hit-detection" title="Direct link to heading">â€‹</a></h2><p><code>CalcButtonBehavior</code> provides a rounded style for our buttons. But the default hit-detection for Views is tied to their rectangular
bounds. We can fix this by writing custom pointer hit-detection in our behavior.</p><div class="codeBlockContainer_J+bg language-kotlin"><div class="codeBlockContent_csEI kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CalcButtonBehavior(textMetrics: TextMetrics): CommonTextButtonBehavior&lt;Button&gt;(textMetrics) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    //...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    override fun contains(view: Button, point: Point): Boolean {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val radius      = view.height / 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val leftCircle  = Circle(center = Point(view.x + radius,            view.center.y), radius = radius)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        val rightCircle = Circle(center = Point(view.bounds.right - radius, view.center.y), radius = radius)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return when {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            point.x &lt; radius              -&gt; point in leftCircle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            point.x &gt; view.width - radius -&gt; point in rightCircle</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            else                          -&gt; point in view.bounds</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>contains(Button, Point)</code> method is called by <code>Button</code> to check whether the pointer is within its bounds. This logic ensures
the pointer will only &quot;hit&quot; our button when it goes within the rounded rectangle.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The <code>contains</code> check provides a <code>Point</code> in the View&#x27;s <strong>parent&#x27;s</strong> coordinates.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3ly5" id="testing">Testing<a aria-hidden="true" class="hash-link" href="#testing" title="Direct link to heading">â€‹</a></h2><p>Common code testing is one reason to use a multi-platform setup. Doodle is designed to avoid platform specific dependencies except in the
small amount of launch code. This means we can easily test <code>Calculator</code> and the other components by writing tests in <code>commonTest</code>
and running them on the JVM target. One advantage is the speed of running these tests, since there are no external dependencies.</p><p>The tests in <a href="https://github.com/nacular/doodle-tutorials/blob/master/Calculator/src/commonTest/kotlin/io/nacular/doodle/examples/CalculatorTests.kt#L13" target="_blank" rel="noopener noreferrer"><code>CalculatorTests</code></a>
are a bit contrived, but they illustrate how you might validate various parts of your app.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/doodle-tutorials/docs/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/doodle-tutorials/docs/todo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Todo<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-setup" class="table-of-contents__link toc-highlight">Project Setup</a></li><li><a href="#defining-our-application" class="table-of-contents__link toc-highlight">Defining Our Application</a></li><li><a href="#launching-on-web-and-desktop" class="table-of-contents__link toc-highlight">Launching on Web and Desktop</a></li><li><a href="#creating-a-fullscreen-web-app" class="table-of-contents__link toc-highlight">Creating A Fullscreen Web App</a></li><li><a href="#the-calculator-view" class="table-of-contents__link toc-highlight">The Calculator View</a><ul><li><a href="#calculator-output" class="table-of-contents__link toc-highlight">Calculator Output</a></li></ul></li><li><a href="#more-dependencies" class="table-of-contents__link toc-highlight">More Dependencies</a></li><li><a href="#the-buttons" class="table-of-contents__link toc-highlight">The Buttons</a></li><li><a href="#button-styling" class="table-of-contents__link toc-highlight">Button Styling</a></li><li><a href="#custom-hit-detection" class="table-of-contents__link toc-highlight">Custom Hit Detection</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/doodle-tutorials/assets/js/runtime~main.7ef2cd64.js"></script>
<script src="/doodle-tutorials/assets/js/main.8507df74.js"></script>
</body>
</html>